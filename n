#!/bin/bash

CONTEXT_FILE="vps_master_context.md"

echo "# ðŸ–¥ï¸ RELATÃ“RIO DE ARQUITETURA TOTAL - VPS" > $CONTEXT_FILE
echo "Gerado em: $(date)" >> $CONTEXT_FILE

echo -e "\n## ðŸš€ 1. PROCESSOS PM2 (Sistemas em ExecuÃ§Ã£o)" >> $CONTEXT_FILE
pm2 jlist | jq -r 'map({name: .name, status: .pm2_env.status, cpu: .monit.cpu, mem: .monit.memory})' >> $CONTEXT_FILE

echo -e "\n## ðŸ³ 2. DOCKER STACKS E CONTAINERS" >> $CONTEXT_FILE
docker ps --format "table {{.Names}}\t{{.Image}}\t{{.Status}}\t{{.Ports}}" >> $CONTEXT_FILE

echo -e "\n## ðŸŒ 3. REDES DOCKER (ComunicaÃ§Ã£o Interna)" >> $CONTEXT_FILE
docker network ls >> $CONTEXT_FILE

echo -e "\n## ðŸ“‚ 4. ESTRUTURA DE PASTAS E PROJETOS (/home)" >> $CONTEXT_FILE
# Lista as pastas principais ignorando o que Ã© pesado
ls -R /home --ignore=node_modules --ignore=.next --ignore=dist -L 2 >> $CONTEXT_FILE

echo -e "\n## ðŸ’¾ 5. USO DE DISCO E PARTIÃ‡Ã•ES" >> $CONTEXT_FILE
df -h | grep '^/dev/' >> $CONTEXT_FILE

echo -e "\n## ðŸ§ª 6. VERSÃ•ES TÃ‰CNICAS" >> $CONTEXT_FILE
echo "Node: $(node -v)" >> $CONTEXT_FILE
echo "Docker: $(docker -v)" >> $CONTEXT_FILE
echo "NPM: $(npm -v)" >> $CONTEXT_FILE

echo "âœ… Mapa da VPS gerado em $CONTEXT_FILE"
